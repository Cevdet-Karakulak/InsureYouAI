@model List<PolicyTypeViewModel>

<div class="col-12 col-lg-4 col-xl-4 d-flex">
    <div class="card w-100 rounded-4 shadow-sm border-0">
        <div class="card-body">
            <div class="d-flex align-items-center mb-3">
                <div>
                    <h6 class="mb-0 fw-bold text-dark">Poliçe Durum Dağılımı</h6>
                    <small class="text-muted">Anlık Poliçe İstatistikleri</small>
                </div>
                <div class="fs-5 ms-auto dropdown">
                    <div class="dropdown-toggle dropdown-toggle-nocaret cursor-pointer text-muted" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots"></i>
                    </div>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Rapor Al</a></li>
                        <li><a class="dropdown-item" href="#">Yenile</a></li>
                    </ul>
                </div>
            </div>

            <div class="d-flex justify-content-center">
                <div id="policyStatusChart" style="min-height: 250px;"></div>
            </div>
        </div>

        <ul class="list-group list-group-flush mb-0 shadow-none rounded-bottom-4">
            @for (int i = 0; i < Model.Count; i++)
            {
                // Renkleri sırasıyla atamak için basit bir dizi mantığı
                string[] colors = { "text-primary", "text-success", "text-warning", "text-danger", "text-info" };
                string currentColor = colors[i % colors.Length]; // Renk sayısından fazla veri varsa başa döner

                <li class="list-group-item bg-transparent border-top py-3">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-circle-fill me-2 font-weight-bold @currentColor" style="font-size: 0.8rem;"></i>
                        <span class="fw-semibold text-secondary">@Model[i].PolicyTypeName</span>
                        <span class="ms-auto badge bg-light text-dark border rounded-pill px-3">@Model[i].Count</span>
                    </div>
                </li>
            }
        </ul>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // C# Modelinden verileri JS dizilerine çeviriyoruz
        var labels = @Json.Serialize(Model.Select(x => x.PolicyTypeName));
        var series = @Json.Serialize(Model.Select(x => x.Count));

        // Modern Renk Paleti (Mavi, Yeşil, Turuncu, Kırmızı, Açık Mavi)
        var chartColors = ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#0dcaf0'];

        var options = {
            series: series,
            chart: {
                type: 'donut',
                height: 280,
                fontFamily: 'Segoe UI, sans-serif'
            },
            labels: labels,
            colors: chartColors,
            plotOptions: {
                pie: {
                    donut: {
                        size: '70%', // Halkanın kalınlığı
                        labels: {
                            show: true,
                            name: {
                                show: true,
                                fontSize: '14px',
                            },
                            value: {
                                show: true,
                                fontSize: '20px',
                                fontWeight: 600,
                                offsetY: 5,
                            },
                            total: {
                                show: true,
                                showAlways: true,
                                label: 'Toplam',
                                fontSize: '14px',
                                fontWeight: 600,
                                color: '#6c757d',
                            }
                        }
                    }
                }
            },
            dataLabels: {
                enabled: false // Grafiğin üstünde kalabalık yapmasın diye kapattık
            },
            legend: {
                show: false // Zaten altta listemiz var, legend'ı gizleyip sadeleştirdik
            },
            stroke: {
                show: true,
                width: 0 // Halka aralarındaki çizgiyi kaldırdık, daha clean görünüm
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return val + " Adet"
                    }
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#policyStatusChart"), options);
        chart.render();
    });
</script>